"use strict";(self.webpackChunkreact_native_android_widget_docs=self.webpackChunkreact_native_android_widget_docs||[]).push([[7386],{3905:(e,t,n)=>{n.d(t,{Zo:()=>l,kt:()=>m});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var d=r.createContext({}),p=function(e){var t=r.useContext(d),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},l=function(e){var t=p(e.components);return r.createElement(d.Provider,{value:t},e.children)},g={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},c=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,d=e.parentName,l=o(e,["components","mdxType","originalType","parentName"]),c=p(n),m=a,u=c["".concat(d,".").concat(m)]||c[m]||g[m]||i;return n?r.createElement(u,s(s({ref:t},l),{},{components:n})):r.createElement(u,s({ref:t},l))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,s=new Array(i);s[0]=c;var o={};for(var d in t)hasOwnProperty.call(t,d)&&(o[d]=t[d]);o.originalType=e,o.mdxType="string"==typeof e?e:a,s[1]=o;for(var p=2;p<i;p++)s[p]=n[p];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}c.displayName="MDXCreateElement"},8636:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>s,default:()=>g,frontMatter:()=>i,metadata:()=>o,toc:()=>p});var r=n(7462),a=(n(7294),n(3905));const i={sidebar_position:2},s="registerWidgetTaskHandler",o={unversionedId:"api/register-widget-task-handler",id:"api/register-widget-task-handler",title:"registerWidgetTaskHandler",description:"react-native-android-widget exports a registerWidgetTaskHandler function that can be used to register a task handler that can handle widget click events, widget resize events, widget added events...",source:"@site/docs/api/register-widget-task-handler.md",sourceDirName:"api",slug:"/api/register-widget-task-handler",permalink:"/react-native-android-widget/docs/api/register-widget-task-handler",draft:!1,editUrl:"https://github.com/sAleksovski/react-native-android-widget/tree/master/docs/docs/api/register-widget-task-handler.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"default",previous:{title:"WidgetPreview",permalink:"/react-native-android-widget/docs/api/widget-preview"},next:{title:"requestWidgetUpdate",permalink:"/react-native-android-widget/docs/api/request-widget-update"}},d={},p=[{value:"Usage",id:"usage",level:2},{value:"Register widget task handler",id:"register-widget-task-handler",level:2},{value:"Register widget task handler (Expo)",id:"register-widget-task-handler-expo",level:2},{value:"Types",id:"types",level:2}],l={toc:p};function g(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},l,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"registerwidgettaskhandler"},"registerWidgetTaskHandler"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"react-native-android-widget")," exports a ",(0,a.kt)("inlineCode",{parentName:"p"},"registerWidgetTaskHandler")," function that can be used to register a task handler that can handle widget click events, widget resize events, widget added events..."),(0,a.kt)("h2",{id:"usage"},"Usage"),(0,a.kt)("p",null,"First, create a task handler function, containing:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="widget-task-handler.ts"',title:'"widget-task-handler.ts"'},"import React from 'react';\nimport type { WidgetTaskHandlerProps } from 'react-native-android-widget';\nimport { HelloWidget } from './HelloWidget';\n\nconst nameToWidget = {\n  // Hello will be the **name** with which we will reference our widget.\n  Hello: HelloWidget,\n};\n\nexport async function widgetTaskHandler(props: WidgetTaskHandlerProps) {\n  const widgetInfo = props.widgetInfo;\n  const Widget =\n    nameToWidget[widgetInfo.widgetName as keyof typeof nameToWidget];\n\n  switch (props.widgetAction) {\n    case 'WIDGET_ADDED':\n      props.renderWidget(<Widget />);\n      break;\n\n    case 'WIDGET_RESIZED':\n      props.renderWidget(<Widget />);\n      break;\n\n    case 'WIDGET_CLICK':\n      if (props.clickAction === 'play') {\n        props.renderWidget(<Widget status=\"playing\" />);\n      } else {\n        props.renderWidget(<Widget status=\"stopped\" />);\n      }\n      break;\n\n    default:\n      break;\n  }\n}\n")),(0,a.kt)("p",null,"We use ",(0,a.kt)("inlineCode",{parentName:"p"},"nameToWidget")," to map from the ",(0,a.kt)("strong",{parentName:"p"},"name")," to the component defining the widget (useful if we have multiple widgets). There are other ways to achieve this."),(0,a.kt)("p",null,"This file is also where you can execute regular JS code, include asynchronous operations, such as fetching data from API:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="widget-task-handler.ts"',title:'"widget-task-handler.ts"'},"// ...\ncase 'WIDGET_CLICK':\n  if (props.clickAction === 'refresh') {\n    const data = await fetch('https://example.com/api').then((response) => response.json());\n    props.renderWidget(<Widget title={data.title} />);\n  }\n  break;\n")),(0,a.kt)("h2",{id:"register-widget-task-handler"},"Register widget task handler"),(0,a.kt)("p",null,"In the main ",(0,a.kt)("inlineCode",{parentName:"p"},"index.js")," (or ",(0,a.kt)("inlineCode",{parentName:"p"},"index.ts"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"index.tsx"),") file for our app, when we register the main component, register the widget task handler."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="index.ts"',title:'"index.ts"'},"import { AppRegistry } from 'react-native';\nimport { registerWidgetTaskHandler } from 'react-native-android-widget';\nimport { name as appName } from './app.json';\nimport App from './App';\nimport { widgetTaskHandler } from './widget-task-handler';\n\nAppRegistry.registerComponent(appName, () => App);\nregisterWidgetTaskHandler(widgetTaskHandler);\n")),(0,a.kt)("h2",{id:"register-widget-task-handler-expo"},"Register widget task handler (Expo)"),(0,a.kt)("p",null,"If we are using Expo, there is no ",(0,a.kt)("inlineCode",{parentName:"p"},"index.js")," (or ",(0,a.kt)("inlineCode",{parentName:"p"},"index.ts"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"index.tsx"),"), but we can create it."),(0,a.kt)("p",null,"First, update ",(0,a.kt)("inlineCode",{parentName:"p"},"package.json")," main field to point to ",(0,a.kt)("inlineCode",{parentName:"p"},"index.ts")," (or ",(0,a.kt)("inlineCode",{parentName:"p"},".js"),") instead of ",(0,a.kt)("inlineCode",{parentName:"p"},"node_modules/expo/AppEntry.js")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="package.json"',title:'"package.json"'},'{\n  "name": "my-expo-app",\n  "main": "index.ts",\n  ...\n}\n')),(0,a.kt)("p",null,"Create the file, using ",(0,a.kt)("inlineCode",{parentName:"p"},"node_modules/expo/AppEntry.js")," as a template.\nThen import ",(0,a.kt)("inlineCode",{parentName:"p"},"widgetTaskHandler")," and register it."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="index.ts"',title:'"index.ts"'},"import { registerRootComponent } from 'expo';\nimport { registerWidgetTaskHandler } from 'react-native-android-widget';\n\nimport App from './App';\nimport { widgetTaskHandler } from './widget-task-handler';\n\n// registerRootComponent calls AppRegistry.registerComponent('main', () => App);\n// It also ensures that whether you load the app in Expo Go or in a native build,\n// the environment is set up appropriately\nregisterRootComponent(App);\nregisterWidgetTaskHandler(widgetTaskHandler);\n")),(0,a.kt)("h2",{id:"types"},"Types"),(0,a.kt)("p",null,"Check the types in the ",(0,a.kt)("a",{parentName:"p",href:"/docs/public-api#registerwidgettaskhandler"},"Public API")," documentation"),(0,a.kt)("p",null,"The widget task handler will be called with some properties, described with ",(0,a.kt)("a",{parentName:"p",href:"/docs/public-api/interfaces/WidgetTaskHandlerProps"},"WidgetTaskHandlerProps")))}g.isMDXComponent=!0}}]);